<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TikTok Integration Demo UI</title>
  <style>
    :root{--bg:#f6f8fb;--card:#ffffff;--muted:#6b7280;--accent:#25a39a;--danger:#ef4444}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial}
    body{background:linear-gradient(180deg,#f8fbff 0%,var(--bg) 100%);display:flex;align-items:center;justify-content:center;padding:32px}
    .container{width:980px;max-width:96%;background:var(--card);border-radius:12px;box-shadow:0 8px 30px rgba(15,23,42,0.08);padding:28px}
    header{display:flex;gap:20px;align-items:center}
    .logo{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,#25a39a,#0ea5a3);display:flex;align-items:center;justify-content:center;color:white;font-weight:700}
    h1{margin:0;font-size:20px}
    p.lead{margin:4px 0 18px;color:var(--muted)}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:20px}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.9),var(--card));padding:16px;border-radius:10px;border:1px solid rgba(15,23,42,0.03)}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type="text"],input[type="datetime-local"],select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e9ef;font-size:14px}
    input[type="file"]{font-size:13px}
    .row{display:flex;gap:10px}
    button{background:var(--accent);color:#fff;padding:10px 14px;border-radius:8px;border:0;font-weight:600;cursor:pointer}
    button.ghost{background:transparent;color:var(--accent);border:1px solid rgba(37,163,154,0.12)}
    .small{font-size:13px;color:var(--muted)}
    .status{padding:12px;border-radius:8px;background:#f3f7f9;border:1px dashed rgba(15,23,42,0.04);min-height:72px}
    pre{background:#0b1220;color:#e6eef6;padding:12px;border-radius:8px;overflow:auto;font-size:12px}
    footer{margin-top:16px;text-align:center;color:var(--muted);font-size:13px}
    .hint{font-size:12px;color:#7c8796}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="container" role="main">
    <header>
      <div class="logo">TD</div>
      <div>
        <h1>TikTok Integration — Demo UI</h1>
        <p class="lead">A simple frontend to demonstrate Login Kit + Content Posting flow (simulated for sandbox). Copy this file to GitHub Pages and replace the placeholders in the script.</p>
      </div>
    </header>

    <div class="grid" style="margin-top:18px">
      <div class="card">
        <h3 style="margin-top:0">Connect</h3>
        <p class="small">Start by logging in (sandbox). This will open TikTok's OAuth page in a new tab — after authorizing, you will be redirected back to the configured callback. For demo we simulate the token exchange.</p>
        <div style="margin-top:12px" id="connect-area">
          <div class="row" style="margin-bottom:10px">
            <button id="btn-login">Login with TikTok (Sandbox)</button>
            <button id="btn-logout" class="ghost" style="display:none">Logout</button>
          </div>
          <div class="small hint">Redirect URI (must match your n8n / app): <code id="redirect-uri">http://localhost:5678/rest/oauth2-credential/callback</code></div>
        </div>

        <hr style="margin:16px 0">

        <h3 style="margin:0 0 8px">Upload Video (Simulated)</h3>
        <p class="small">Select a file and set caption/hashtags. For demo we do not call TikTok directly — the UI shows the request body and a simulated success response you can use in your app review video.</p>

        <div style="margin-top:10px">
          <label>Video file</label>
          <input type="file" id="videoFile" accept="video/mp4,video/quicktime">
        </div>

        <div style="margin-top:10px">
          <label>Caption</label>
          <input type="text" id="caption" placeholder="Write a short caption...">
        </div>

        <div style="margin-top:10px">
          <label>Hashtags (comma separated)</label>
          <input type="text" id="hashtags" placeholder="#demo, #n8n">
        </div>

        <div style="margin-top:10px">
          <label>Visibility</label>
          <select id="visibility">
            <option value="public">Public</option>
            <option value="private">Private</option>
            <option value="friends">Friends</option>
          </select>
        </div>

        <div style="margin-top:14px" class="row">
          <button id="btn-simulate">Simulate Upload</button>
          <button id="btn-webhook" class="ghost">Send to n8n Webhook</button>
        </div>

        <div style="margin-top:12px" class="status" id="statusBox">
          <div class="small">Status</div>
          <div id="statusText" style="margin-top:8px;color:var(--muted)">Not started</div>
        </div>

      </div>

      <div class="card">
        <h3 style="margin-top:0">Request Preview</h3>
        <p class="small">This panel shows the JSON that your automation (n8n) would receive. Replace <code>WEBHOOK_URL</code> with your n8n webhook URL if you want to send real data.</p>
        <pre id="requestPreview">// Request will appear here</pre>

        <h3 style="margin-top:12px">Response Preview</h3>
        <p class="small">Simulated response that you should show in your demo video.</p>
        <pre id="responsePreview">// Response will appear here</pre>

        <hr style="margin:14px 0">
        <h4 style="margin:6px 0">Options</h4>
        <div style="display:flex;gap:10px;align-items:center">
          <label style="font-size:13px;color:var(--muted)">Webhook URL</label>
        </div>
        <input type="text" id="webhookUrl" placeholder="https://your-n8n-instance/webhook/tiktok-demo" style="margin-top:8px">
        <div style="margin-top:8px" class="small hint">If you have n8n webhook, paste it above and click <strong>Send to n8n Webhook</strong>.</div>
      </div>
    </div>

    <footer>
      <div class="small">Tip: Before recording your TikTok demo video show the request and response panels clearly while you run the workflow in n8n.</div>
    </footer>
  </div>

  <script>
    // ======= PLACEHOLDERS ========
    // Replace CLIENT_KEY and REDIRECT_URI with your values if you want live OAuth (sandbox) to open.
    const CLIENT_KEY = 'YOUR_CLIENT_KEY';
    const REDIRECT_URI = document.getElementById('redirect-uri').textContent.trim();
    const SCOPE = encodeURIComponent('user.info.profile user.info.stats');
    const STATE = 'tiktok_demo_' + Math.random().toString(36).slice(2,9);
    // sandbox auth URL template (may not be reachable in all regions)
    const AUTH_URL = `https://open-api-sandbox.tiktokglobalapi.com/platform/oauth/connect/?client_key=${CLIENT_KEY}&response_type=code&scope=${SCOPE}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&state=${STATE}&access_type=offline`;

    const elLogin = document.getElementById('btn-login');
    const elLogout = document.getElementById('btn-logout');
    const statusText = document.getElementById('statusText');

    // UI helpers
    function toJson(obj){return JSON.stringify(obj, null, 2)}

    // Build request preview
    function buildRequestPreview(){
      const file = document.getElementById('videoFile').files[0];
      const caption = document.getElementById('caption').value;
      const hashtags = document.getElementById('hashtags').value;
      const visibility = document.getElementById('visibility').value;
      const webhook = document.getElementById('webhookUrl').value || 'WEBHOOK_URL';

      const payload = {
        video_name: file ? file.name : 'demo.mp4',
        video_url: 'https://example.com/demo.mp4',
        caption: caption || 'Demo upload via n8n',
        hashtags: hashtags || '#demo,#n8n',
        visibility: visibility
      };

      document.getElementById('requestPreview').textContent = toJson({ url: webhook, method: 'POST', headers: { Authorization: 'Bearer <ACCESS_TOKEN>', 'Content-Type': 'application/json' }, body: payload });

      const resp = { data: { video_id: 'sandbox_video_12345', status: 'uploaded' }, message: 'ok' };
      document.getElementById('responsePreview').textContent = toJson(resp);
      return { payload, resp };
    }

    // Simulate upload
    document.getElementById('btn-simulate').addEventListener('click', async ()=>{
      statusText.textContent = 'Preparing upload...';
      const { payload, resp } = buildRequestPreview();
      await new Promise(r=>setTimeout(r,900));
      statusText.textContent = 'Uploading...';
      await new Promise(r=>setTimeout(r,1200));
      statusText.textContent = 'Upload complete';
      document.getElementById('responsePreview').textContent = JSON.stringify(resp, null, 2);
    });

    // Send to n8n webhook
    document.getElementById('btn-webhook').addEventListener('click', async ()=>{
      const webhook = document.getElementById('webhookUrl').value.trim();
      if(!webhook){ alert('Please set your n8n webhook URL in the Webhook URL field.'); return }
      const { payload, resp } = buildRequestPreview();
      statusText.textContent = 'Sending to webhook...';
      try{
        const res = await fetch(webhook, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(payload) });
        if(res.ok){
          statusText.textContent = 'n8n webhook received the data';
        } else {
          statusText.textContent = 'Webhook responded with status ' + res.status;
        }
      }catch(err){
        statusText.textContent = 'Webhook error: ' + err.message;
      }
    });

    // Login button (opens auth URL in new tab) — useful if sandbox oauth is reachable
    elLogin.addEventListener('click', (e)=>{
      if(CLIENT_KEY === 'YOUR_CLIENT_KEY'){
        if(!confirm('CLIENT_KEY is not set. The demo will simulate OAuth. Click OK to continue with simulation or Cancel to open the OAuth URL.')){
          // open auth URL anyway
          window.open(AUTH_URL, '_blank');
        } else {
          // simulate login
          statusText.textContent = 'Simulated login: sandbox_user_12345';
          elLogin.style.display = 'none'; elLogout.style.display = 'inline-block';
        }
      } else {
        window.open(AUTH_URL, '_blank');
      }
    });

    elLogout.addEventListener('click', ()=>{
      statusText.textContent = 'Logged out';
      elLogin.style.display = 'inline-block'; elLogout.style.display = 'none';
    });

    // Initialize preview on load
    buildRequestPreview();

    // Rebuild preview when input changes
    document.getElementById('caption').addEventListener('input', buildRequestPreview);
    document.getElementById('hashtags').addEventListener('input', buildRequestPreview);
    document.getElementById('visibility').addEventListener('change', buildRequestPreview);
    document.getElementById('videoFile').addEventListener('change', buildRequestPreview);
    document.getElementById('webhookUrl').addEventListener('input', buildRequestPreview);
  </script>
</body>
</html>
